import AlternatingSections from '../components/AlternatingSections'
import Container from 'react-bootstrap/Container'
import Alert from 'react-bootstrap/Alert'
import Col from 'react-bootstrap/Col'
import Row from 'react-bootstrap/Row'
import Button from 'react-bootstrap/Button'
import Card from 'react-bootstrap/Card'
import ContentHeaderSection from '../components/ContentHeaderSection'
import Layout from '../components/Layout'
import MetaTags from '../components/MetaTags'
import Link from 'next/link'
import {Console, ConsoleCommand, ConsoleOutput} from '../components/Console'

<MetaTags
    title="CryFS: Tutorial"
    url="https://www.cryfs.org/tutorial"
    type="article"
    description="A quick and easy introduction into the basic usage of CryFS. CryFS encrypts your Dropbox and protects you against hackers and data leaks. It also works well together with other cloud providers."
/>

<Layout>
<AlternatingSections start_index={1}>
<ContentHeaderSection title="Tutorial" subtitle="CryFS is very easy to use. Let us show you how." />

<section>
<Container>

## Overview

CryFS encrypts your files so you can safely store them anywhere. It works well with popular cloud services like Dropbox, Google Drive, OneDrive, or any other service that syncs a local folder.

Unlike some other encryption tools, CryFS doesn't just encrypt the contents of your files—it also encrypts file names, file sizes, and the directory structure. This means that even if someone gains access to your cloud storage, they cannot see what files you have, how big they are, or how they're organized.

**What you'll learn in this tutorial:**
- How to install CryFS
- How to create and use an encrypted directory
- How to sync encrypted files with cloud storage
- Best practices for keeping your data secure

</Container>
</section>

<section>
<Container>

## Prerequisites

Before starting, make sure you have:

- A Linux, macOS, or Windows computer
- Basic familiarity with using the command line
- (Optional) A cloud storage client installed if you want to sync encrypted files

CryFS runs on all major operating systems. On Linux and macOS, it uses FUSE (Filesystem in Userspace). On Windows, it uses Dokany or WinFsp.

<Alert variant="info">
**Prefer a graphical interface?** If you're not comfortable with the command line, you can use <a href="https://mhogomchungu.github.io/sirikali/" target="_blank" rel="noopener noreferrer">SiriKali</a>—a GUI application that supports CryFS along with other encryption tools. SiriKali is available for Linux and macOS, and provides a user-friendly way to create, mount, and manage encrypted volumes.
</Alert>

</Container>
</section>

<section>
<Container>

## Install CryFS

See <Link href="/#download">Download Instructions</Link> for installation packages and instructions for your operating system.

After installation, verify CryFS is working by checking its version:

<Console>
    <ConsoleCommand>cryfs --version</ConsoleCommand>
    <ConsoleOutput>CryFS Version 0.11.4</ConsoleOutput>
</Console>

</Container>
</section>

<section>
<Container>

## Create an encrypted directory

To create an encrypted directory, run <kbd>cryfs basedir mountdir</kbd> where:
- **basedir** is where your encrypted data will be stored (the "vault")
- **mountdir** is where you'll access your unencrypted files

You can name these directories anything you like. If they don't exist, CryFS will offer to create them.

<Console>
    <ConsoleCommand>cryfs basedir mountdir</ConsoleCommand>
</Console>

CryFS will ask you a few questions:

1. **Encryption settings**: Press Enter to accept the default settings, which use secure, recommended values (256-bit AES encryption).
2. **Password**: Choose a strong, unique password. This password is the only way to access your data—if you forget it, your files cannot be recovered.

<Alert variant="info">
**Tip**: Use a password manager to generate and store a strong password. A good password should be at least 16 characters and include a mix of letters, numbers, and symbols.
</Alert>

Once configured, your encrypted directory is ready to use. The <var>mountdir</var> directory is a virtual directory provided by CryFS—files you place here are automatically encrypted and stored in <var>basedir</var>.

</Container>
</section>

<section>
<Container>

## Using the encrypted directory

You can work with <var>mountdir</var> just like any normal folder. Add files, create subdirectories, edit documents—everything is automatically encrypted and stored in <var>basedir</var>.

Let's try it out. First, create a file and a directory:

<Console>
    <ConsoleCommand>cd mountdir</ConsoleCommand>
    <ConsoleCommand>echo "My secret notes" &gt; notes.txt</ConsoleCommand>
    <ConsoleCommand>mkdir documents</ConsoleCommand>
</Console>

Verify the file was created:

<Console>
    <ConsoleCommand>ls</ConsoleCommand>
    <ConsoleOutput>documents notes.txt</ConsoleOutput>
    <ConsoleCommand>cat notes.txt</ConsoleCommand>
    <ConsoleOutput>My secret notes</ConsoleOutput>
</Console>

Now look at what's stored in <var>basedir</var>—you'll see encrypted blocks instead of your actual files:

<Console>
    <ConsoleCommand>ls ../basedir</ConsoleCommand>
    <ConsoleOutput>3A2 7F9 B4E cryfs.config [more encrypted blocks]</ConsoleOutput>
</Console>

The file names, sizes, and directory structure are all hidden. An attacker looking at <var>basedir</var> would have no idea what's inside.

### Unmounting and remounting

When you're done working with your files, unmount the encrypted directory:

<Console>
    <ConsoleCommand>cd ..</ConsoleCommand>
    <ConsoleCommand>cryfs-unmount mountdir</ConsoleCommand>
</Console>

<Alert variant="info">
**Note**: On CryFS versions 0.9.x and earlier, use <kbd>fusermount -u mountdir</kbd> instead.
</Alert>

After unmounting, <var>mountdir</var> will be empty—your data is safely locked away:

<Console>
    <ConsoleCommand>ls mountdir</ConsoleCommand>
    <ConsoleOutput>[empty]</ConsoleOutput>
</Console>

Your encrypted data remains in <var>basedir</var>. To access your files again, simply remount:

<Console>
    <ConsoleCommand>cryfs basedir mountdir</ConsoleCommand>
    <ConsoleCommand>ls mountdir</ConsoleCommand>
    <ConsoleOutput>documents notes.txt</ConsoleOutput>
    <ConsoleCommand>cat mountdir/notes.txt</ConsoleCommand>
    <ConsoleOutput>My secret notes</ConsoleOutput>
</Console>

</Container>
</section>

<section>
<Container>

## Using CryFS with cloud storage

CryFS was designed to work seamlessly with cloud storage services. By placing your <var>basedir</var> inside your cloud sync folder, your encrypted files are automatically uploaded and synced across devices.

This works with any cloud service that syncs a local folder, including:
- Dropbox
- Google Drive
- Microsoft OneDrive
- iCloud Drive
- Nextcloud
- Syncthing
- And many others

### Setting up cloud sync

First, identify your cloud service's local sync folder. Common locations include:
- **Dropbox**: `~/Dropbox`
- **Google Drive**: `~/Google Drive` or `~/My Drive`
- **OneDrive**: `~/OneDrive`
- **iCloud Drive** (macOS): `~/Library/Mobile Documents/com~apple~CloudDocs`

Then create your encrypted directory with <var>basedir</var> inside the sync folder:

<Console>
    <ConsoleCommand>cryfs ~/Dropbox/encrypted mountdir</ConsoleCommand>
</Console>

<Alert variant="danger">
**Important**: Place only the <var>basedir</var> (encrypted data) in your cloud folder. Never place <var>mountdir</var> (unencrypted data) in a synced location, or your unencrypted files will be uploaded to the cloud.
</Alert>

Now everything you save to <var>mountdir</var> is encrypted and synced to your cloud storage automatically.

### Accessing from multiple devices

To access your encrypted files from another computer:

1. Install CryFS and your cloud client on the second device
2. Wait for your cloud service to sync the encrypted folder
3. Run CryFS with the same paths:

<Console>
    <ConsoleCommand>cryfs ~/Dropbox/encrypted mountdir</ConsoleCommand>
</Console>

Enter your password, and you'll have access to all your files.

<Alert variant="warning">
**Warning**: Never mount the same encrypted directory on two devices simultaneously. Always unmount CryFS on one device and wait for cloud sync to complete before mounting on another device. Concurrent access from multiple devices can corrupt your filesystem.
</Alert>

</Container>
</section>

<section>
<Container>

## Best practices

Follow these guidelines to keep your data secure:

### Password security
- Use a strong, unique password (16+ characters recommended)
- Store your password in a password manager
- Never share your password or store it in plain text

### Backup your configuration
The <var>cryfs.config</var> file in your <var>basedir</var> contains encryption parameters. While your password is the primary key, this file is needed to decrypt your data. If you use cloud storage, it's automatically backed up. Otherwise, consider keeping a separate backup.

### Safe unmounting
Always unmount CryFS properly before:
- Shutting down your computer
- Putting your computer to sleep
- Disconnecting external drives containing your basedir

<Console>
    <ConsoleCommand>cryfs-unmount mountdir</ConsoleCommand>
</Console>

### Cloud sync considerations
- Wait for sync to complete before mounting on another device
- Avoid making changes while your cloud client is paused
- Check your cloud service's sync status before switching devices

</Container>
</section>

<section>
<Container>

## Troubleshooting

### "mountdir is not empty"
CryFS requires an empty mount directory. Remove any files from <var>mountdir</var> before mounting:
<Console>
    <ConsoleCommand>rm -rf mountdir/*</ConsoleCommand>
    <ConsoleCommand>cryfs basedir mountdir</ConsoleCommand>
</Console>

### "Wrong password" but you're sure it's correct
Password verification is case-sensitive. Check that Caps Lock isn't enabled and that your keyboard layout is correct.

### Slow performance with large files
CryFS encrypts data in blocks, which can slow down operations on very large files. This is normal and ensures security. For best performance, avoid storing extremely large files (multiple gigabytes) that need frequent random access.

### Unmount fails with "device is busy"
Close all applications and terminals that might be accessing files in <var>mountdir</var>, then try again:
<Console>
    <ConsoleCommand>cd ~</ConsoleCommand>
    <ConsoleCommand>cryfs-unmount mountdir</ConsoleCommand>
</Console>

If unmount still fails, you can force it (use with caution):
<Console>
    <ConsoleCommand>fusermount -uz mountdir</ConsoleCommand>
</Console>

### For more help
- Check the <Link href="/comparison">comparison page</Link> for details on CryFS features
- Visit our <a href="https://github.com/cryfs/cryfs" target="_blank" rel="noopener noreferrer">GitHub repository</a> to report issues or ask questions

</Container>
</section>

<section>
<Container>

## Next steps

Now that you've set up CryFS, here are some ways to make the most of it:

- **Automate mounting**: Set up scripts to automatically mount your encrypted directories at login
- **Multiple vaults**: Create separate encrypted directories for different purposes (work, personal, etc.)
- **Explore configuration options**: Run <kbd>cryfs --help</kbd> to see advanced options for customizing encryption settings

<Console>
    <ConsoleCommand>cryfs --help</ConsoleCommand>
</Console>

</Container>
</section>

<section>
<Container>
    <Row>
        <Col style={{marginTop: '20px'}} md={{size: 8, offset: 2}}>
            <Card body style={{ backgroundColor: '#f5f5f5', borderColor: '#e3e3e3' }}>
                <div className="text-center">
                    <div className="lead">
                        Ready to get started?
                    </div>
                    <Button as={Link} href="/#download" variant="primary" size="lg">Download CryFS</Button>
                </div>
            </Card>
        </Col>
    </Row>
</Container>
</section>

</AlternatingSections>
</Layout>
