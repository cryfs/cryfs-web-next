import AlternatingSections from '../components/AlternatingSections'
import Container from 'react-bootstrap/Container'
import Alert from 'react-bootstrap/Alert'
import Col from 'react-bootstrap/Col'
import Row from 'react-bootstrap/Row'
import Button from 'react-bootstrap/Button'
import Card from 'react-bootstrap/Card'
import ContentHeaderSection from '../components/ContentHeaderSection'
import Layout from '../components/Layout'
import MetaTags from '../components/MetaTags'
import JsonLd from '../components/JsonLdSchema'
import Link from 'next/link'
import {Console, ConsoleCommand, ConsoleOutput} from '../components/Console'
import {VersionNumber} from '../config/CryfsVersion'
import TableOfContents from '../components/TableOfContents'
import TutorialStep from '../components/TutorialStep'

export const tocItems = [
    { id: 'prerequisites', title: 'Prerequisites', number: 1 },
    { id: 'install-cryfs', title: 'Install CryFS', number: 2 },
    { id: 'create-a-vault', title: 'Create a vault', number: 3 },
    { id: 'using-the-vault', title: 'Using the vault', number: 4 },
    { id: 'cloud-storage', title: 'Cloud storage sync', number: 5 },
    { id: 'best-practices', title: 'Best practices', number: 6 },
    { id: 'troubleshooting', title: 'Troubleshooting', number: 7 },
];

export const howToSchema = {
    '@type': 'HowTo',
    name: 'How to encrypt your cloud storage with CryFS',
    description: 'A quick and easy introduction into the basic usage of CryFS. CryFS encrypts your Dropbox and protects you against hackers and data leaks. It also works well together with other cloud providers.',
    tool: 'CryFS',
    step: [
        {
            '@type': 'HowToStep',
            name: 'Install CryFS',
            text: 'Download and install CryFS on your system. CryFS is available for Linux, macOS, and Windows.',
            url: 'https://www.cryfs.org/tutorial#install-cryfs',
            position: 1,
        },
        {
            '@type': 'HowToStep',
            name: 'Setup an encrypted directory',
            text: 'Run "cryfs vaultdir mountdir" to create an encrypted directory. CryFS will ask for a password and create the necessary directories.',
            url: 'https://www.cryfs.org/tutorial#setup-an-encrypted-directory',
            position: 2,
        },
        {
            '@type': 'HowToStep',
            name: 'Use the encrypted directory',
            text: 'Work with files in the mountdir directory normally. CryFS encrypts everything automatically and stores it in vaultdir.',
            url: 'https://www.cryfs.org/tutorial#using-the-encrypted-directory',
            position: 3,
        },
        {
            '@type': 'HowToStep',
            name: 'Connect to cloud storage',
            text: 'Place the vaultdir inside your Dropbox, Google Drive, or other cloud sync folder. The encrypted files will sync automatically.',
            url: 'https://www.cryfs.org/tutorial#using-cryfs-together-with-dropbox',
            position: 4,
        },
    ],
}

<MetaTags
    title="CryFS: Tutorial"
    url="https://www.cryfs.org/tutorial"
    type="article"
    description="A quick and easy introduction into the basic usage of CryFS. CryFS encrypts your Dropbox and protects you against hackers and data leaks. It also works well together with other cloud providers."
/>
<JsonLd schema={howToSchema} />

<Layout>
<AlternatingSections start_index={1}>
<ContentHeaderSection title="Tutorial" subtitle="Learn how to encrypt your files with CryFS in minutes." />

<section>
<Container>

<Row>
<Col lg={8}>

CryFS encrypts your files so you can safely store them anywhere. It works well with popular cloud services like Dropbox, Google Drive, OneDrive, or any other service that syncs a local folder.

Unlike some other encryption tools, CryFS doesn't just encrypt the contents of your files—it also encrypts file names, file sizes, and the directory structure. This means that even if someone gains access to your cloud storage, they cannot see what files you have, how big they are, or how they're organized.

</Col>
<Col lg={4}>
<TableOfContents items={tocItems} />
</Col>
</Row>

</Container>
</section>

<section>
<Container>

<TutorialStep number={1} title="Prerequisites" id="prerequisites">

Before starting, make sure you have:

- A Linux, macOS, or Windows computer
- Basic familiarity with using the command line
- (Optional) A cloud storage client installed if you want to sync encrypted files

CryFS runs on all major operating systems. On Linux and macOS, it uses FUSE (Filesystem in Userspace). On Windows, it uses Dokany or WinFsp.

<Alert variant="info">
**Prefer a graphical interface?** GUI applications are available:
- <a href="https://mhogomchungu.github.io/sirikali/" target="_blank" rel="noopener noreferrer">SiriKali</a> (Linux, macOS) — Supports CryFS along with other encryption tools
- <a href="https://invent.kde.org/plasma/plasma-vault" target="_blank" rel="noopener noreferrer">Plasma Vault</a> (KDE Plasma) — Built into the KDE Plasma desktop
</Alert>

</TutorialStep>

</Container>
</section>

<section>
<Container>

<TutorialStep number={2} title="Install CryFS" id="install-cryfs">

See <Link href="/#download">Download Instructions</Link> for installation packages and instructions for your operating system.

After installation, verify CryFS is working by checking its version:

<Console>
    <ConsoleCommand>cryfs --version</ConsoleCommand>
    <ConsoleOutput>CryFS Version {VersionNumber}</ConsoleOutput>
</Console>

</TutorialStep>

</Container>
</section>

<section>
<Container>

<TutorialStep number={3} title="Create a vault" id="create-a-vault">

To create a vault, run <kbd>cryfs vaultdir mountdir</kbd> where:
- **vaultdir** is where your encrypted data will be stored
- **mountdir** is where you'll access your unencrypted files

You can name these directories anything you like. If they don't exist, CryFS will offer to create them.

<Console>
    <ConsoleCommand>cryfs vaultdir mountdir</ConsoleCommand>
</Console>

CryFS will ask you a few questions:

1. **Encryption settings**: Press Enter to accept the default settings, which use secure, recommended values (XChaCha20-Poly1305 encryption).
2. **Password**: Choose a strong, unique password. This password is the only way to access your data—if you forget it, your files cannot be recovered.

<Alert variant="info">
**Tip**: Use a password manager to generate and store a strong password. A good password should be at least 16 characters and include a mix of letters, numbers, and symbols.
</Alert>

Once configured, your vault is ready to use. The <var>mountdir</var> directory is a virtual directory provided by CryFS—files you place here are automatically encrypted and stored in <var>vaultdir</var>.

</TutorialStep>

</Container>
</section>

<section>
<Container>

<TutorialStep number={4} title="Using the vault" id="using-the-vault">

You can work with <var>mountdir</var> just like any normal folder. Add files, create subdirectories, edit documents—everything is automatically encrypted and stored in <var>vaultdir</var>.

Let's try it out. First, create a file and a directory:

<Console>
    <ConsoleCommand>cd mountdir</ConsoleCommand>
    <ConsoleCommand>echo "My secret notes" &gt; notes.txt</ConsoleCommand>
    <ConsoleCommand>mkdir documents</ConsoleCommand>
</Console>

Verify the file was created:

<Console>
    <ConsoleCommand>ls</ConsoleCommand>
    <ConsoleOutput>documents notes.txt</ConsoleOutput>
    <ConsoleCommand>cat notes.txt</ConsoleCommand>
    <ConsoleOutput>My secret notes</ConsoleOutput>
</Console>

Now look at what's stored in <var>vaultdir</var>—you'll see encrypted blocks instead of your actual files:

<Console>
    <ConsoleCommand>ls ../vaultdir</ConsoleCommand>
    <ConsoleOutput>3A2 7F9 B4E cryfs.config [more encrypted blocks]</ConsoleOutput>
</Console>

The file names, sizes, and directory structure are all hidden. An attacker looking at <var>vaultdir</var> would have no idea what's inside.

### Unmounting and remounting

When you're done working with your files, unmount the vault:

<Console>
    <ConsoleCommand>cd ..</ConsoleCommand>
    <ConsoleCommand>cryfs-unmount mountdir</ConsoleCommand>
</Console>

After unmounting, <var>mountdir</var> will be empty—your data is safely locked away:

<Console>
    <ConsoleCommand>ls mountdir</ConsoleCommand>
    <ConsoleOutput>[empty]</ConsoleOutput>
</Console>

Your encrypted data remains in <var>vaultdir</var>. To access your files again, simply remount:

<Console>
    <ConsoleCommand>cryfs vaultdir mountdir</ConsoleCommand>
    <ConsoleCommand>ls mountdir</ConsoleCommand>
    <ConsoleOutput>documents notes.txt</ConsoleOutput>
    <ConsoleCommand>cat mountdir/notes.txt</ConsoleCommand>
    <ConsoleOutput>My secret notes</ConsoleOutput>
</Console>

</TutorialStep>

</Container>
</section>

<section>
<Container>

<TutorialStep number={5} title="Using CryFS with cloud storage" id="cloud-storage">

CryFS was designed to work seamlessly with cloud storage services. By placing your <var>vaultdir</var> inside your cloud sync folder, your encrypted files are automatically uploaded and synced across devices.

This works with any cloud service that syncs a local folder:

<Row className="mb-4">
<Col sm={6} md={4}>
- Dropbox
- Google Drive
- Microsoft OneDrive
</Col>
<Col sm={6} md={4}>
- iCloud Drive
- Nextcloud
- Syncthing
</Col>
</Row>

### Setting up cloud sync

First, identify your cloud service's local sync folder. Common locations include:
- **Dropbox**: `~/Dropbox`
- **Google Drive**: `~/Google Drive` or `~/My Drive`
- **OneDrive**: `~/OneDrive`
- **iCloud Drive** (macOS): `~/Library/Mobile Documents/com~apple~CloudDocs`

Then create your vault with <var>vaultdir</var> inside the sync folder:

<Console>
    <ConsoleCommand>cryfs ~/Dropbox/myvault mountdir</ConsoleCommand>
</Console>

<Alert variant="danger">
**Important**: Place only the <var>vaultdir</var> (encrypted data) in your cloud folder. Never place <var>mountdir</var> (unencrypted data) in a synced location, or your unencrypted files will be uploaded to the cloud.
</Alert>

Now everything you save to <var>mountdir</var> is encrypted and synced to your cloud storage automatically.

### Accessing from multiple devices

To access your vault from another computer:

1. Install CryFS and your cloud client on the second device
2. Wait for your cloud service to completely sync the vault folder
3. Run CryFS with the same paths:

<Console>
    <ConsoleCommand>cryfs ~/Dropbox/myvault mountdir</ConsoleCommand>
</Console>

Enter your password, and you'll have access to all your files.

<Alert variant="warning">
**Warning**: Never mount the same vault on two devices simultaneously. Always unmount CryFS on one device and wait for cloud sync to complete before mounting on another device. Concurrent access from multiple devices can corrupt your filesystem.
</Alert>

</TutorialStep>

</Container>
</section>

<section>
<Container>

<TutorialStep number={6} title="Best practices" id="best-practices">

Follow these guidelines to keep your data secure:

### Password security
- Use a strong, unique password (16+ characters recommended)
- Store your password in a password manager
- Never share your password or store it in plain text

### Backup your configuration
The <var>cryfs.config</var> file in your <var>vaultdir</var> contains encryption parameters. While your password is the primary key, this file is needed to decrypt your data. If you use cloud storage, it's automatically backed up. Otherwise, consider keeping a separate backup.

### Next steps
- **Automate mounting**: Set up scripts to automatically mount your vaults at login
- **Multiple vaults**: Create separate vaults for different purposes (work, personal, etc.)
- **Explore configuration options**: Run <kbd>cryfs --help</kbd> to see advanced options

<Console>
    <ConsoleCommand>cryfs --help</ConsoleCommand>
</Console>

</TutorialStep>

</Container>
</section>

<section>
<Container>

<TutorialStep number={7} title="Troubleshooting" id="troubleshooting">

### "mountdir is not empty"
CryFS requires an empty mount directory. Remove any files from <var>mountdir</var> before mounting:
<Console>
    <ConsoleCommand>rm -rf mountdir/*</ConsoleCommand>
    <ConsoleCommand>cryfs vaultdir mountdir</ConsoleCommand>
</Console>

### "Wrong password" but you're sure it's correct
Password verification is case-sensitive. Check that Caps Lock isn't enabled and that your keyboard layout is correct.

### Slow performance with large files
CryFS encrypts data in blocks, which can slow down operations on very large files. This is normal and ensures security. For vaults storing mostly large files, you can improve performance by increasing the block size when creating the vault (choose "No" when asked about default settings).

### Unmount fails with "device is busy"
Close all applications and terminals that might be accessing files in <var>mountdir</var>, then try again:
<Console>
    <ConsoleCommand>cd ~</ConsoleCommand>
    <ConsoleCommand>cryfs-unmount mountdir</ConsoleCommand>
</Console>

If unmount still fails, you can force it (use with caution):
<Console>
    <ConsoleCommand>fusermount -uz mountdir</ConsoleCommand>
</Console>

### For more help
- Check the <Link href="/comparison">comparison page</Link> for details on CryFS features
- Visit our <a href="https://github.com/cryfs/cryfs" target="_blank" rel="noopener noreferrer">GitHub repository</a> to report issues or ask questions

</TutorialStep>

</Container>
</section>

<section>
<Container>
    <Row className="justify-content-center">
        <Col md={8} lg={6}>
            <Card className="text-center shadow-sm" style={{ backgroundColor: '#f8f9fa', border: '1px solid #e9ecef' }}>
                <Card.Body className="py-4">
                    <Card.Title as="h3" className="mb-3" style={{ border: 'none', paddingBottom: 0, marginTop: 0 }}>
                        Ready to get started?
                    </Card.Title>
                    <Card.Text className="text-muted mb-4">
                        Download CryFS and start encrypting your files today.
                    </Card.Text>
                    <Button as={Link} href="/#download" variant="primary" size="lg" className="px-4">
                        Download CryFS
                    </Button>
                </Card.Body>
            </Card>
        </Col>
    </Row>
</Container>
</section>

</AlternatingSections>
</Layout>
